<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CoreSight Access Library: Library Demonstration Programs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CoreSight Access Library
   &#160;<span id="projectnumber">2.3</span>
   </div>
   <div id="projectbrief">ARM CoreSight Access Library - on target CoreSight component control</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Library Demonstration Programs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The demonstration programs provide examples of the usage of the library for a set of supported boards. The examples show how to register a system with the library, and then set-up and extract trace from the system. These programs and associated makefile are provided in the <code>./demos</code> directory.</p>
<p>Board support is provided for a number of standard ARM platforms:-</p><ul>
<li>ST-Ericsson Snowball</li>
<li>ARM Versatile Express Cortex-A15x2+A7x3 ("TC2")</li>
<li>Juno (ARMv8-A development board), revisions r0 and r1.</li>
</ul>
<p>Support for other platforms can be created by following the examples above to create specific packages for the desired board.</p>
<h2>The Example Programs </h2>
<p>The example programs provided are:-</p>
<ul>
<li><code>csls</code>: A simple CoreSight list program that decodes a CoreSight ROM table and lists the components found there.</li>
<li><code>cs_etm_config_demo</code>: A program demonstrating and printing the configuration of an ETM or PTM component.</li>
<li><code>tracedemo</code>: A program to capture trace on a running linux system.</li>
<li><code>trace_cti_stop</code> : This captures trace on the running system in a similar way to tracedemo, but uses the CTIs channels and triggers to inject a trigger-packet into the trace for each core, control the trace generated by the cores, and trigger the ETB to flush and halt capture.</li>
</ul>
<p>These programs can be built on a target system using the supplied <code>makefile</code>.</p>
<h2>The Example Source Code </h2>
<p>The examples link to both the main CS Access library, and the CS Access Utility library.</p>
<p>The source example files provided are:-</p>
<ul>
<li><code>cs_demo_known_boards.c</code> and <code>cs_demo_known_boards.h</code> : These files provide a list of known hardware boards for use in the demos. This list is passed to the CS Access Utility library <code><a class="el" href="group__cs__lib__reg.html#ga7065e0ef24520d6a4d3c3839360e428b">setup_board()</a></code> or <code><a class="el" href="group__cs__lib__reg.html#gab2b9af3e7e2b71af4b78738ee6a68dbc">setup_named_board()</a></code> function.</li>
<li><code>csls.c</code> : main program source for the csls example.</li>
<li><code>cs_etm_config_demo.c</code> : main program source for the etm configuration demo.</li>
<li><code>tracedemo.c</code> : main program source for the trace capture demo.</li>
<li><code>tracedemo_cti_stop.c</code> : main program to trigger and stop trace capture using CTIs.</li>
</ul>
<h2>Using the Makefile </h2>
<p>Running <code>make</code> in the <code>./demos</code> directory, or <code>make</code> in the project root directory will build the default release versions of all the demo programs. These will be created in the <code>../bin/&lt;arch&gt;/rel</code> output directory, relative to <code>./demos</code>. The build process links to the csaccess libraries built into the <code>../lib/&lt;arch&gt;/rel</code> directory.</p>
<p>When built from the project root directory, the demos are built with the same command line options as the main library.</p>
<p>By default <code>csls</code>, <code>tracedemo</code>, <code>etmdemo</code> and <code>trace_cti_stop</code> are built.</p>
<p>Individual programs can be built using the name of the program on the make command line if run in the ./demos directory. When building individual demos, use the same make command line options as building the CSAL library.</p>
<p>e.g. The following command line builds the debug version of <code>tracedemo</code> </p><pre class="fragment">make tracedemo DEBUG=1 
</pre><h1>Building and Running the TraceDemo Example </h1>
<p>This section covers the details for running the TraceDemo example on a supported board. The set-up procedures here also apply to running any of the other examples on a target system.</p>
<h2>Setting up the Example </h2>
<p>The sources are provided in <code>[DS-5 install dir]/examples/CoreSight_Access_Library.zip</code>.</p>
<p>First, import the example into the DS-5 Eclipse workspace as follows:</p><ol type="1">
<li>Launch Eclipse for DS-5.</li>
<li>Close the Welcome screen, if it appears.</li>
<li>From the <b>File</b> menu, select <b>Import...</b>. The Import wizard opens.</li>
<li>Open the <b>General</b> folder.</li>
<li>Select <b>Existing Projects into Workspace</b></li>
<li>Press <b>Next</b></li>
<li>Press <b>Browse...</b> next to <b>Select archive file:</b>. A file dialog opens.</li>
<li>Navigate to <code>[DS-5 install dir]\examples</code>, select <code>Coresight_Access_Library.zip</code>, then press 'OK'. The <b>Projects:</b> field populates with the project(s) found in the <code>.zip</code>.</li>
<li>Press <b>Finish</b>. The 'Project' view populates with the project(s).</li>
</ol>
<p>Next, boot Linux on your target, login (preferably as root), and get the IP address of the target using <code>ifconfig</code>. Then copy the <code>CoreSight_access</code> directory from the workspace to a suitable writable directory on your Linux target, either using Remote System Explorer as provided in DS-5 or using a secure copy program such as <code>scp</code> (Windows versions of this Linux command are available, such as <code>pscp</code> as provided with "Putty").</p>
<h2>Configuring the Example for your Target </h2>
<p>Before you can use the example on your target, you may have to modify some of the source files to suit your target:</p>
<ul>
<li>If your target is not one of the platforms already supported, then you will need to add a "registration" function into <code>cs_demo_known_boards.c</code>. To do this add an entry in the <code>known_boards[]</code> array, and write a suitable registration function.</li>
<li>To configure the range of addresses to be traced in the kernel, open <code>tracedemo.c</code> and modify the values of:<ul>
<li><code>KERNEL_TRACE_SIZE</code> is the extent of the region to trace, and</li>
<li><code>KERNEL_TRACE_VIRTUAL_ADDR</code> is the virtual address of the start of the region to trace, i.e. corresponding to addresses in the vmlinux file. If not set, it will default to the kernel load address plus 0x50000.</li>
</ul>
</li>
</ul>
<p>One way to identify the addresses of candidate regions/functions to trace is to use, for example: </p><pre class="fragment">grep cpu_idle /proc/kallsyms
</pre><h2>Configuring your Target for the Example </h2>
<p>Before using the example on your target, check the following:</p>
<ul>
<li><p class="startli">For <code>tracedemo</code> to use <code>mmap</code> to read kernel memory (which it then dumps to a file <code>kernel_dump.bin</code> that can be read by DS-5 Debugger), the kernel must have been built without <code>CONFIG_STRICT_DEVMEM=y</code>.</p>
<p class="startli">You can check this by typing: </p><pre class="fragment">zgrep "CONFIG_STRICT_DEVMEM" /proc/config.gz
</pre><p class="startli">If the kernel has been built with <code>CONFIG_STRICT_DEVMEM=y</code>, then you must either rebuild it with <code>CONFIG_STRICT_DEVMEM=n</code> or dump the kernel memory manually by some other means, for example, use DS-5 Debugger and DSTREAM to dump this kernel memory from the target (with, for example, the CLI command <code>dump memory kernel_dump.bin 0xC0008000 +0x50000</code>), or extract this kernel memory from the kernel Image file.</p>
</li>
<li>For <code>tracedemo</code> to use <code>mmap()</code> to read kernel memory via <code>/dev/kmem</code>, the kernel must have been built with <code>CONFIG_DEVKMEM=y</code>.</li>
<li><p class="startli">To view the disassembly and trace augmented with symbols (e.g. function names), the <code>vmlinux</code> file for the kernel must be available, built with debug symbols. To map the trace and disassembly back to kernel source files, the kernel source tree must also be available.</p>
<p class="startli">The <code>vmlinux</code> file with debug symbols is created when the kernel is built with debug info (<code>CONFIG_DEBUG_INFO=y</code>). You can check how your kernel was built by typing: </p><pre class="fragment">grep "CONFIG_DEBUG_INFO" /proc/config.gz
</pre><p class="startli">If using <code>make menuconfig</code> to rebuild the kernel, select the following under 'Kernel Hacking': </p><pre class="fragment">[*] Kernel debugging
    [*] Compile the kernel with debug info
</pre></li>
</ul>
<h2>Juno Platform - Additional Configuration when using the CSAL and Demos </h2>
<p>These are additional steps required on Juno systems to ensure correct operation of the CSAL.</p>
<p>The scripts mentioned below are shipped in the <code>demos/juno_demo_setup</code> directory.</p>
<p><b>Preventing Core Power Down when Idle</b></p>
<p>The Juno examples were built and tested on a Juno system that prevented the power down of idle cores. This was to ensure that all the resources were accessible when the examples were run.</p>
<p>To achieve this:-</p>
<p>1) Create a file with the following contents with a suitable name (e.g. no_cpu_idle.sh). </p><pre class="fragment">#!/bin/sh
for i in 0 1 2 3 4 5; do
  for j in 0 1 2 ; do
    echo 1 &gt; /sys/devices/system/cpu/cpu$i/cpuidle/state$j/disable;
  done;
done
</pre><p>This can be run each time the system is booted. Alternatively, the following steps automate the process:-</p>
<p>2) Copy the file into <code>/etc/init.d/</code></p>
<p>3) Run the following command to create an execute on boot link </p><pre class="fragment">ln -s /etc/init.d/YOUR_FILE_NAME  /etc/rc5.d/S99_disable_cpuidle.sh
</pre><p>4) Reboot and confirm that idle is disabled by checking one of the cores (not core0) </p><pre class="fragment">cat /sys/devices/system/cpu/cpu3/cpuidle/state1/disable
</pre><p>See <a href="http://community.arm.com/docs/DOC-9320">FAQ: Why am I having problems connecting a debugger to the Juno in DS-5?</a></p>
<p><b>Ensuring Debug Hardware Correctly Powered</b></p>
<p>Early Juno system SCP firmware had no way to power up the CoreSight debug hardware without a request from an external debugger. This results in a hang when accessing the CoreSight ROM table and other CoreSight hardware.</p>
<p>This has been corrected using firmware release for Linux kernel 4.9. (16.11 release package).</p>
<p>The workaround is to force a DAP power-up request on the application DAP by briefly attaching an external debug system.</p>
<p>The following script can be used with a DSTREAM connection in the CSAT tool shipped with DS-5 to power the DAPs. </p><pre class="fragment"># Wake DAPS on a Juno system - allow CSAL to access CS debug hardware
echo Powering Juno DAPs.

# set the scan chain.
chain dev=ARMCS-DP,ARMCS-DP

# connect to first - will force power up
dvo 0

# check DP register for power ACK bits
drr dp.csw

dvc

# connect to second - will force power up
dvo 1

# check DP register for power ACK bits
drr dp.csw

dvc

echo Done
</pre><p>To use:-</p>
<p>1) Copy the script into a suitable file - e.g. <code>juno_wake_dap.cst</code></p>
<p>2) Connect DSTREAM to your Juno board. Run the CSAT tool and connect to your DSTREAM.</p>
<p>3) On the CSAT command line type </p><pre class="fragment">%&gt; batch juno_wake_dap.cst
</pre><p>4) Disconnect CSAT and DSTREAM.</p>
<h2>Running the demonstration example </h2>
<p>Run the <code>tracedemo</code> Linux application as root from the <code>.\bin\rel</code> directory: </p><pre class="fragment">./tracedemo
</pre><p>This will auto-detect the target board (if supported), configure trace generation, and retrieve trace from the trace buffer.</p>
<p>If the board is not correctly detected then the following command line may be used: </p><pre class="fragment">./tracedemo -board-name Juno
</pre><p>The name parameter (Juno in this example) must match the <code>.hardware</code> structure element in the <code>known_boards[]</code> array in the <code>cs_demo_known_boards.c</code> file.</p>
<p>To view the possible run options, add "-h" for help: </p><pre class="fragment">./tracedemo -h
</pre><p>You will see output like: </p><pre class="fragment">Usage:
-h      This help screen.
-c &lt;cpu&gt;;        Select CPU for demo to run on. Default 0
-itm    Enable ITM tracing, ITM tracing disabled by default.
-full   Show full trace with no filtering.
-pause  Run the demo with a pause after each step.
</pre><p>If you see: <code>** csaccess: ERROR: can't open /dev/mem</code>, then try running it as sudo: </p><pre class="fragment">sudo ./tracedemo
</pre><p>You will see output like (for Snowball): </p><pre class="fragment">root@linaro-ubuntu-desktop:/home/root/CoreSight_access# ./tracedemo
Default configuration, no CPU affinity selected. ITM disabled.
CoreSight demonstrator
** Currently affine CPUs: #0 #1
CSDEMO: Detected 'ST-Ericsson Snowball platform' board
CSDEMO: Registering Snowball CoreSight devices...
801A4000: 1.2 907 00000000 00/0F type= 7 - SINK BUFFER(8K)
801A5000: 4.1 906 00040800 00/0F type=10 - CTI
801A6000: 2.1 908 00000028 00/0F type= 4 - LINK
801A8000: 5.1 C09 00000000 00/FF type=11 - CPU DEBUG v7 (full CP14) (4 wpt) (6 bkpt) non-Secure auth=AF
801A9000: 6.1 9A0 00000000 00/FF type=12 - CPU PMU (6 counters) auth=8C
801AA000: 5.1 C09 00000000 00/FF type=11 - CPU DEBUG v7 (full CP14) (4 wpt) (6 bkpt) non-Secure auth=AF
801AB000: 6.1 9A0 00000000 00/FF type=12 - CPU PMU (6 counters) auth=8C
801AC000: 4.1 906 00040800 00/0F type=10 - CTI
801AD000: 4.1 906 00040800 00/0F type=10 - CTI
801AE000: 3.1 950 00000000 00/FF type= 1 - CPU SOURCE PTMv1.0
801AF000: 3.1 950 00000000 00/FF type= 1 - CPU SOURCE PTMv1.0
CSDEMO: Registering CPU affinities...
CSDEMO: Registering trace-bus connections...
CSDEMO: Registration complete.
CSDEMO: Configuring trace...
CSDEMO: Configuring trace source id for CPU #0 ETM/PTM...
CSDEMO: Initialising ETM/PTM
** 801AE000: write 030 (off) = 0000406F now 00000000
** 801AE000: write 150 (off) = 00000000 now 00020000
CSDEMO: Configuring trace source id for CPU #1 ETM/PTM...
CSDEMO: Initialising ETM/PTM
** 801AF000: write 030 (off) = 0000406F now 00000000
** 801AF000: write 150 (off) = 00000000 now 00020000
ETM static configuration:
  ETMCCR = 8D294004
  ETMCCER = 000008EA
  ETMSCR = 00000000
  ETMIDR = 411CF301
ETM dynamic configuration:
  ETMCR = 00000000
  Trace enable event: true
  Trace enable control: CR1=00000001 CR2=00000000
  Trace start comparators: 0000
  Trace stop comparators: 0000
  Counters: 2
    #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
    #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
  Address comparators: 8
    #0: address=C0008000 type=00000019 (execute) (size=4) (S:all) (NS:all)
    #1: address=C0058000 type=00000019 (execute) (size=4) (S:all) (NS:all)
  Sequencer present: 1
  Sequencer:
    Current state: 1
    1 -&gt; 2: single-addr-comp-0
    1 -&gt; 3: false
    2 -&gt; 1: false
    2 -&gt; 3: single-addr-comp-1
    3 -&gt; 1: false
    3 -&gt; 2: false
** 801AE000: write 080 (CS_ETMACTR(i)) = 00000019 now 00000001
** 801AE000: write 084 (CS_ETMACTR(i)) = 00000019 now 00000001
CSDEMO: Reading back configuration after programming...
ETM static configuration:
  ETMCCR = 8D294004
  ETMCCER = 000008EA
  ETMSCR = 00000000
  ETMIDR = 411CF301
ETM dynamic configuration:
  ETMCR = 00000400
  Cycle accurate: 0
  Branch output: 0
  Timestamp enabled: 0
  CONTEXTID size: 0 bytes
  Trace enable event: true
  Trace enable control: CR1=00000001 CR2=00000000
  Trace start comparators: 0000
  Trace stop comparators: 0000
  Trigger event: false
  Counters: 2
    #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
    #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
  Address comparators: 8
    #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #2: address=6D7C9CB5 type=00000E01 (execute) (size=1) (S:none) (NS:none)
    #3: address=59425D80 type=00000C01 (execute) (size=1) (S:none) (NS:none)
    #4: address=FC1B425D type=00000401 (execute) (size=1) (S:none) (NS:all)
    #5: address=C085D159 type=00000B01 (execute) (size=1) (S:all) (NS:none)
    #6: address=CF79EACF type=00000801 (execute) (size=1) (S:all) (NS:none)
    #7: address=AB4DF605 type=00000B01 (execute) (size=1) (S:all) (NS:none)
  Data comparators: 0
  Sequencer present: 1
  Sequencer:
    Current state: 1
    1 -&gt; 2: single-addr-comp-0
    1 -&gt; 3: false
    2 -&gt; 1: false
    2 -&gt; 3: single-addr-comp-1
    3 -&gt; 1: false
    3 -&gt; 2: false
  CONTEXTID comparators: 1
    Mask: FFFFFFFF
    #0: contextid: 00000000
  External outputs:
    #0: false
    #1: false
ETM static configuration:
  ETMCCR = 8D294004
  ETMCCER = 000008EA
  ETMSCR = 00000000
  ETMIDR = 411CF301
ETM dynamic configuration:
  ETMCR = 00000000
  Trace enable event: true
  Trace enable control: CR1=00000001 CR2=00000000
  Trace start comparators: 0000
  Trace stop comparators: 0000
  Counters: 2
    #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
    #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
  Address comparators: 8
    #0: address=C0008000 type=00000019 (execute) (size=4) (S:all) (NS:all)
    #1: address=C0058000 type=00000019 (execute) (size=4) (S:all) (NS:all)
  Sequencer present: 1
  Sequencer:
    Current state: 1
    1 -&gt; 2: single-addr-comp-0
    1 -&gt; 3: false
    2 -&gt; 1: false
    2 -&gt; 3: single-addr-comp-1
    3 -&gt; 1: false
    3 -&gt; 2: false
** 801AF000: write 080 (CS_ETMACTR(i)) = 00000019 now 00000001
** 801AF000: write 084 (CS_ETMACTR(i)) = 00000019 now 00000001
CSDEMO: Reading back configuration after programming...
ETM static configuration:
  ETMCCR = 8D294004
  ETMCCER = 000008EA
  ETMSCR = 00000000
  ETMIDR = 411CF301
ETM dynamic configuration:
  ETMCR = 00000400
  Cycle accurate: 0
  Branch output: 0
  Timestamp enabled: 0
  CONTEXTID size: 0 bytes
  Trace enable event: true
  Trace enable control: CR1=00000001 CR2=00000000
  Trace start comparators: 0000
  Trace stop comparators: 0000
  Trigger event: false
  Counters: 2
    #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
    #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
  Address comparators: 8
    #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #2: address=B277380E type=00000D01 (execute) (size=1) (S:none) (NS:none)
    #3: address=E8FF4E39 type=00000D01 (execute) (size=1) (S:none) (NS:none)
    #4: address=989EAE80 type=00000801 (execute) (size=1) (S:all) (NS:none)
    #5: address=45FB31E5 type=00000F01 (execute) (size=1) (S:none) (NS:none)
    #6: address=E5F180E4 type=00000C01 (execute) (size=1) (S:none) (NS:none)
    #7: address=B6FD1362 type=00000301 (execute) (size=1) (S:all) (NS:all)
  Data comparators: 0
  Sequencer present: 1
  Sequencer:
    Current state: 1
    1 -&gt; 2: single-addr-comp-0
    1 -&gt; 3: false
    2 -&gt; 1: false
    2 -&gt; 3: single-addr-comp-1
    3 -&gt; 1: false
    3 -&gt; 2: false
  CONTEXTID comparators: 1
    Mask: FFFFFFFF
    #0: contextid: 00000000
  External outputs:
    #0: false
    #1: false
CSDEMO: Enabling trace...
CSDEMO: Configured and enabled trace.
CSDEMO: Trace configured
CSDEMO: Created trace configuration export files
CSDEMO: trace buffer contents: 8192 bytes
[press RETURN to stop tracing or q/Q to quit]
CSDEMO: Disable trace...
CSDEMO: trace buffer contents: 8192 bytes
ETM static configuration:
  ETMCCR = 8D294004
  ETMCCER = 000008EA
  ETMSCR = 00000000
  ETMIDR = 411CF301
ETM dynamic configuration:
  ETMCR = 10001400
  Cycle accurate: 1
  Branch output: 0
  Timestamp enabled: 1
  CONTEXTID size: 0 bytes
  Trace enable event: true
  Trace enable control: CR1=00000001 CR2=00000000
  Trace start comparators: 0000
  Trace stop comparators: 0000
  Trigger event: false
  Counters: 2
    #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
    #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
  Address comparators: 8
    #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #2: address=6D7C9CB5 type=00000E01 (execute) (size=1) (S:none) (NS:none)
    #3: address=59425D80 type=00000C01 (execute) (size=1) (S:none) (NS:none)
    #4: address=FC1B425D type=00000401 (execute) (size=1) (S:none) (NS:all)
    #5: address=C085D159 type=00000B01 (execute) (size=1) (S:all) (NS:none)
    #6: address=CF79EACF type=00000801 (execute) (size=1) (S:all) (NS:none)
    #7: address=AB4DF605 type=00000B01 (execute) (size=1) (S:all) (NS:none)
  Data comparators: 0
  Sequencer present: 1
  Sequencer:
    Current state: 1
    1 -&gt; 2: single-addr-comp-0
    1 -&gt; 3: false
    2 -&gt; 1: false
    2 -&gt; 3: single-addr-comp-1
    3 -&gt; 1: false
    3 -&gt; 2: false
  CONTEXTID comparators: 1
    Mask: FFFFFFFF
    #0: contextid: 00000000
  External outputs:
    #0: false
    #1: false
ETM static configuration:
  ETMCCR = 8D294004
  ETMCCER = 000008EA
  ETMSCR = 00000000
  ETMIDR = 411CF301
ETM dynamic configuration:
  ETMCR = 10001400
  Cycle accurate: 1
  Branch output: 0
  Timestamp enabled: 1
  CONTEXTID size: 0 bytes
  Trace enable event: true
  Trace enable control: CR1=00000001 CR2=00000000
  Trace start comparators: 0000
  Trace stop comparators: 0000
  Trigger event: false
  Counters: 2
    #0: value=00001000 enable=single-addr-comp-0 reload_value=00002000 reload_event=counter-zero-0
    #1: value=00001000 enable=sequencer-state-2 reload_value=00002000 reload_event=counter-zero-1
  Address comparators: 8
    #0: address=C0008000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #1: address=C0058000 type=00000001 (execute) (size=1) (S:all) (NS:all)
    #2: address=B277380E type=00000D01 (execute) (size=1) (S:none) (NS:none)
    #3: address=E8FF4E39 type=00000D01 (execute) (size=1) (S:none) (NS:none)
    #4: address=989EAE80 type=00000801 (execute) (size=1) (S:all) (NS:none)
    #5: address=45FB31E5 type=00000F01 (execute) (size=1) (S:none) (NS:none)
    #6: address=E5F180E4 type=00000C01 (execute) (size=1) (S:none) (NS:none)
    #7: address=B6FD1362 type=00000301 (execute) (size=1) (S:all) (NS:all)
  Data comparators: 0
  Sequencer present: 1
  Sequencer:
    Current state: 1
    1 -&gt; 2: single-addr-comp-0
    1 -&gt; 3: false
    2 -&gt; 1: false
    2 -&gt; 3: single-addr-comp-1
    3 -&gt; 1: false
    3 -&gt; 2: false
  CONTEXTID comparators: 1
    Mask: FFFFFFFF
    #0: contextid: 00000000
  External outputs:
    #0: false
    #1: false
CSDEMO: Fetching trace from core ETB:
  Buffer RAM size: 8192
  Bytes to read in buffer: 8192
  Buffer has wrapped: 1
** 8192 bytes of trace
The first 256 bytes of trace are:
 80 01 AE D3 8E 01 4C 01 08 90 58 01 C0 29 CC 02  0C CA 00 9F FA 0C 48 01 08 E0 66 01 C0 29 EC 27
 A0 01 E6 C1 0E 68 02 08 9C 68 00 C0 28 D0 04 E6  AA D8 14 40 00 08 00 17 02 C0 28 CC 02 CC 02 65
 BE D8 14 60 00 08 A8 0C 00 C0 28 F4 02 AC F2 35  0C AE 88 08 94 89 02 C0 28 E8 02 AC A8 08 C4 38
 88 03 C0 29 DC 0B D6 8C 02 50 00 A9 84 01 70 69  00 F0 23 01 A0 FD 00 7C 00 C6 00 FB 8E 02 78 3D
 00 ED 18 6C 00 A4 EA 01 A0 E8 00 AC 08 74 18 25  00 C0 28 FC 08 A4 08 E0 66 01 C0 29 E0 AF 00 97
 E6 C1 0E 54 00 08 78 18 00 C0 28 C8 0C B4 08 37  E8 00 00 C0 28 FC 5A C4 02 08 BC 97 00 C0 28 9E
 F0 06 E2 18 58 01 F8 01 E4 03 EE AB 0A 28 08 62  0C 01 00 C0 28 E8 06 91 9E D1 00 1C 08 DC 48 BE
 04 C0 28 C8 BE 02 C4 05 08 FC 48 05 C0 29 DC 27  04 9C 98 0A 78 03 23 D3 D8 24 14 08 DC 49 04 8A
CSDEMO: shutdown...
</pre><p>Depending on the configuration, <code>tracedemo</code> creates a number of output files such as <code>snapshot.ini</code>, <code>cpu_0.ini</code>, <code>cpu_1.ini</code>, <code>device_2.ini</code>, <code>device_3.ini</code>, <code>trace.ini</code>, <code>kernel_dump.bin</code> and <code>cstrace.bin</code>. These files can be loaded into DS-5 Debugger to analyze the collected trace, as described in the next section.</p>
<p>Copy these files from the target into a suitable writable directory on your host, either using Remote System Explorer in DS-5 or <code>scp</code> (or <code>pscp</code> on Windows).</p>
<p>To create a standalone package of files for decoding by DS-5 Debugger, for example to give to someone else, collect the files above, together with <code>vmlinux</code>, and the kernel source tree.</p>
<h2>Analyzing the collected trace in DS-5 (v5.21 onwards) </h2>
<p>The files created by <code>tracedemo</code>, after copying to the host, can be loaded into DS-5 Debugger to analyze the collected trace as follows:</p>
<ol type="1">
<li>Launch Eclipse for DS-5.</li>
<li>From the <b>Window</b> menu, select <b>Perspective</b> -&gt; <b>Open Perspective</b> -&gt; <b>DS-5 Debug</b>.</li>
<li>From the <b>Run</b> menu, select <b>Debug Configurations...</b>.</li>
<li>In the <b>Debug Configurations</b> dialog, open the <b>DS-5 Debugger</b> node.</li>
<li>Create a new debug configuration and give it a name.</li>
<li>In the <b>Debugger</b> tab click the <b>Connect only</b> radio button.</li>
<li>In the <b>Connection</b> tab tree view, open the <b>Generic</b> platform, then select <b>SnapShot</b> -&gt; <b>View Snapshot</b> -&gt; <b>View Snapshot</b>.</li>
<li><p class="startli">In the Connection field below, enter the path to the top-level snapshot contents file <code>snapshot.ini</code>. You can use the <b>File...</b> button to navigate to the file.</p>
<p class="startli">To load the ready-made example files, specify e.g.</p>
<p class="startli"><code>.../DS-5 Workspace/CoreSight_access/example_captures/Snowball/snapshot.ini</code>.</p>
</li>
<li><p class="startli">To view the disassembly and trace augmented with symbols (e.g. function names), the <code>vmlinux</code> file for the kernel must be given.</p>
<p class="startli">In the <b>Files</b> tab, select <b>Load symbols from file</b>, and use the <b>File System...</b> or <b>Workspace...</b> buttons to navigate to the <code>vmlinux</code> file.</p>
</li>
<li><p class="startli">In cases where the kernel modifies itself, you can force DS-5 Debugger to use program code from <code>kernel_dump.bin</code> rather than <code>vmlinux</code>.</p>
<p class="startli">In the <b>Debugger</b> tab, tick <b>Execute debugger commands</b>, and add <code>set trust-ro-sections-for-opcodes off</code> to its field</p>
</li>
<li>Press <b>Debug</b>.</li>
</ol>
<p>Ready-made example files captured from a session on a Snowball (ARMv7-A) target, an ARM TC2 (ARMv7-A) and a Juno (ARMv8-A) target are provided in the <code>./example_captures/Snowball</code>, <code>./example_captures/TC2</code> and <code>./example_captures/Juno</code> directories that can be used for test or demo purposes. Ready-made debug config launch files <code>Generic-Snapshot-&lt;platform&gt;.launch</code> are also provided for each of the above ready made captures.</p>
<h2>Known issues and troubleshooting </h2>
<ul>
<li>If you see: <code>** csaccess: ERROR: can't open /dev/mem</code>, then try running <code>tracedemo</code> as either root or sudo: <pre class="fragment">sudo ./tracedemo
</pre></li>
<li><p class="startli">If you see: </p><pre class="fragment">Unable to connect to snapshot.ini
Unable to configure connection to system specified in configuration file
Couldn't find size of 'kernel_dump.bin' - perhaps the file is missing or unreadable
</pre><p class="startli">then <code>kernel_dump.bin</code> is missing or unreadable. (Re-)create <code>kernel_dump.bin</code> as described earlier. </p>
</li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Sep 26 2019 14:16:04 for CoreSight Access Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
